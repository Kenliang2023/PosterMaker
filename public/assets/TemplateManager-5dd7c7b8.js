import{_ as I,s as q,r as m,g as E,o as u,c as y,a as l,b as o,w as i,h as z,i as _,F as V,e as h,f as T,j as C,t as a,d as F}from"./index-6863ed63.js";const N={name:"TemplateManager",components:{Search:q},data(){return{filterProductType:"",filterScene:"",filterStyle:"",searchKeyword:"",templates:[],filteredTemplates:[],loading:!1,productTypes:["LED灯带","LED面板灯","LED射灯","LED灯管","LED路灯"],applicationScenes:["商业空间","家居空间","办公空间","户外景观","工业环境","通用"],styleTypes:["科技未来","温馨","现代商务","自然","简约","现代"],dialogVisible:!1,viewDialogVisible:!1,dialogType:"add",saving:!1,currentTemplate:this.getEmptyTemplate(),formRules:{templateId:[{required:!0,message:"请输入模板ID",trigger:"blur"},{pattern:/^[a-z0-9-]+$/,message:"模板ID只能包含小写字母、数字和连字符",trigger:"blur"}],productType:[{required:!0,message:"请选择产品类型",trigger:"change"}],foreground:[{required:!0,message:"请输入前景描述",trigger:"blur"}],background:[{required:!0,message:"请输入背景描述",trigger:"blur"}]}}},computed:{generatedPrompt(){if(!this.currentTemplate)return"";const r=this.currentTemplate;return this.generatePromptFromTemplate(r,"示例产品名称","特点1、特点2、特点3")},viewGeneratedPrompt(){if(!this.currentTemplate)return"";const r=this.currentTemplate;return this.generatePromptFromTemplate(r,"示例产品名称","特点1、特点2、特点3")}},mounted(){this.fetchTemplates()},methods:{async fetchTemplates(){this.loading=!0;try{const e=await(await fetch("/api/prompts/product-templates")).json();e.success?(this.templates=e.templates,this.filterTemplates()):this.$message.error("获取模板列表失败: "+(e.message||"未知错误"))}catch(r){console.error("获取模板列表出错:",r),this.$message.error("获取模板列表失败，请检查网络连接")}finally{this.loading=!1}},refreshTemplates(){this.fetchTemplates()},filterTemplates(){this.templates.length&&(this.filteredTemplates=this.templates.filter(r=>{let e=!0;if(this.filterProductType&&r.productType!==this.filterProductType&&(e=!1),this.filterScene&&r.applicationScene!==this.filterScene&&(e=!1),this.filterStyle&&r.styleType!==this.filterStyle&&(e=!1),this.searchKeyword){const f=this.searchKeyword.toLowerCase();(r.templateId.toLowerCase()+" "+r.productType.toLowerCase()+" "+r.applicationScene.toLowerCase()+" "+r.styleType.toLowerCase()+" "+r.foreground.toLowerCase()+" "+r.background.toLowerCase()+" "+r.description.toLowerCase()).includes(f)||(e=!1)}return e}))},showAddDialog(){this.dialogType="add",this.currentTemplate=this.getEmptyTemplate(),this.dialogVisible=!0},editTemplate(r){this.dialogType="edit",this.currentTemplate=JSON.parse(JSON.stringify(r)),this.viewDialogVisible=!1,this.dialogVisible=!0},handleRowClick(r){this.currentTemplate=JSON.parse(JSON.stringify(r)),this.viewDialogVisible=!0},async saveTemplate(){this.$refs.templateForm.validate(async r=>{if(!r)return!1;this.saving=!0;try{const f=await(await fetch("/api/prompts/product-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.currentTemplate)})).json();f.success?(this.$message.success(this.dialogType==="add"?"创建模板成功":"更新模板成功"),this.dialogVisible=!1,this.fetchTemplates()):this.$message.error((this.dialogType==="add"?"创建":"更新")+"模板失败: "+(f.message||"未知错误"))}catch(e){console.error("保存模板失败:",e),this.$message.error("保存模板失败，请检查网络连接")}finally{this.saving=!1}})},confirmDelete(r){this.$confirm(`确定要删除模板 "${r.templateId}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.deleteTemplate(r.templateId)}).catch(()=>{})},async deleteTemplate(r){this.loading=!0;try{const f=await(await fetch(`/api/prompts/product-template/${r}`,{method:"DELETE"})).json();f.success?(this.$message.success("删除模板成功"),this.fetchTemplates()):this.$message.error("删除模板失败: "+(f.message||"未知错误"))}catch(e){console.error("删除模板失败:",e),this.$message.error("删除模板失败，请检查网络连接")}finally{this.loading=!1}},getEmptyTemplate(){return{templateId:"",productType:"LED灯带",applicationScene:"商业空间",styleType:"科技未来",position:"中央",foreground:"",background:"",featurePosition:"底部",layout:"",backgroundDesc:"",lightingRequirements:"",textRequirements:"",colorTone:"",posterSize:"1:1",overallStyle:"",description:"",score:0,usageCount:0}},generatePromptFromTemplate(r,e,f){return`一张${e}商业海报。

产品位于海报${r.position}，前景描述：${r.foreground}，和海报背景无缝组成完整海报。

海报的背景是：${r.background}。

产品特点文字位于${r.featurePosition}，写着"${f}"。

整体布局：${r.layout||"产品居中，背景环绕，文字简洁"}。

背景描述：${r.backgroundDesc||"材质+光线+质感"}。

光影要求：${r.lightingRequirements||"从产品投射柔和光线"}。

文字要求：${r.textRequirements||"中等大小，清晰易读"}。

色调要求：${r.colorTone||"根据产品特点选择和谐色调"}。

海报尺寸：${r.posterSize}。

海报整体风格：${r.overallStyle||r.styleType}。

左上角品牌 LOGO 写着："RS-LED"，右下角公司网址写着"www.rs-led.com"，左下角是很小的公司二维码。`},formatDate(r){return r?new Date(r).toLocaleString():""}}},O={class:"template-manager"},B={class:"template-manager-container"},M={class:"filter-actions"},j={class:"filters"},J={class:"actions"},K={class:"templates-list"},A={class:"form-grid"},G={class:"form-grid"},H={class:"form-grid"},Q={class:"form-grid"},W={class:"preview-section"},X={class:"preview-content"},Y={class:"preview-text"},Z={class:"dialog-footer"},$={key:0,class:"template-view"},ee={class:"template-header"},le={class:"template-meta"},te={class:"meta-item"},se={class:"value"},oe={class:"meta-item"},re={class:"value"},ie={class:"meta-item"},ae={class:"value"},ne={class:"meta-item"},de={class:"value"},ue={class:"meta-item"},pe={class:"value"},me={class:"content-columns"},ce={class:"content-column"},fe={class:"detail-item"},Te={class:"detail-value"},ve={class:"detail-item"},ge={class:"detail-value"},ye={class:"detail-item"},be={class:"detail-value"},_e={class:"detail-item"},Ve={class:"detail-value"},he={class:"detail-item"},we={class:"detail-value"},Se={class:"detail-item"},ke={class:"detail-value"},Ce={class:"detail-text"},De={class:"content-column"},xe={class:"detail-item"},Ue={class:"detail-value"},Le={class:"detail-item"},Pe={class:"detail-value"},Re={class:"detail-item"},Ie={class:"detail-value"},qe={class:"detail-item"},Ee={class:"detail-value"},ze={class:"detail-item"},Fe={class:"detail-value"},Ne={class:"detail-item"},Oe={class:"detail-value"},Be={class:"detail-item"},Me={class:"detail-value"},je={class:"detail-item"},Je={class:"detail-value"},Ke={class:"preview-section"},Ae={class:"preview-content"},Ge={class:"preview-text"},He={class:"dialog-footer"};function Qe(r,e,f,D,t,d){const c=m("el-option"),b=m("el-select"),x=m("Search"),U=m("el-icon"),p=m("el-input"),v=m("el-button"),g=m("el-table-column"),S=m("el-rate"),L=m("el-table"),n=m("el-form-item"),P=m("el-form"),k=m("el-dialog"),R=E("loading");return u(),y("div",O,[e[58]||(e[58]=l("h2",{class:"page-title"},"海报提示词模板管理",-1)),l("div",B,[l("div",M,[l("div",j,[o(b,{modelValue:t.filterProductType,"onUpdate:modelValue":e[0]||(e[0]=s=>t.filterProductType=s),placeholder:"产品类型",clearable:"",onChange:d.filterTemplates},{default:i(()=>[(u(!0),y(V,null,h(t.productTypes,s=>(u(),_(c,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),o(b,{modelValue:t.filterScene,"onUpdate:modelValue":e[1]||(e[1]=s=>t.filterScene=s),placeholder:"应用场景",clearable:"",onChange:d.filterTemplates},{default:i(()=>[(u(!0),y(V,null,h(t.applicationScenes,s=>(u(),_(c,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),o(b,{modelValue:t.filterStyle,"onUpdate:modelValue":e[2]||(e[2]=s=>t.filterStyle=s),placeholder:"风格类型",clearable:"",onChange:d.filterTemplates},{default:i(()=>[(u(!0),y(V,null,h(t.styleTypes,s=>(u(),_(c,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),o(p,{modelValue:t.searchKeyword,"onUpdate:modelValue":e[3]||(e[3]=s=>t.searchKeyword=s),placeholder:"搜索关键词",clearable:"",onInput:d.filterTemplates,style:{width:"200px"}},{prefix:i(()=>[o(U,null,{default:i(()=>[o(x)]),_:1})]),_:1},8,["modelValue","onInput"])]),l("div",J,[o(v,{type:"primary",onClick:d.showAddDialog},{default:i(()=>e[26]||(e[26]=[T("新建模板")])),_:1},8,["onClick"]),o(v,{onClick:d.refreshTemplates},{default:i(()=>e[27]||(e[27]=[T("刷新")])),_:1},8,["onClick"])])]),l("div",K,[z((u(),_(L,{data:t.filteredTemplates,style:{width:"100%"},border:"",onRowClick:d.handleRowClick},{default:i(()=>[o(g,{prop:"templateId",label:"模板ID",width:"180"}),o(g,{prop:"productType",label:"产品类型",width:"120"}),o(g,{prop:"applicationScene",label:"应用场景",width:"120"}),o(g,{prop:"styleType",label:"风格类型",width:"120"}),o(g,{prop:"description",label:"描述"}),o(g,{label:"评分",width:"120"},{default:i(s=>[o(S,{modelValue:s.row.score,"onUpdate:modelValue":w=>s.row.score=w,disabled:"","text-color":"#ff9900","show-score":""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(g,{label:"使用次数",width:"100",prop:"usageCount"}),o(g,{label:"操作",width:"180"},{default:i(s=>[o(v,{size:"small",onClick:C(w=>d.editTemplate(s.row),["stop"])},{default:i(()=>e[28]||(e[28]=[T("编辑")])),_:2},1032,["onClick"]),o(v,{size:"small",type:"danger",onClick:C(w=>d.confirmDelete(s.row),["stop"])},{default:i(()=>e[29]||(e[29]=[T("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onRowClick"])),[[R,t.loading]])])]),o(k,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[21]||(e[21]=s=>t.dialogVisible=s),title:t.dialogType==="add"?"新建模板":"编辑模板",width:"80%","destroy-on-close":""},{footer:i(()=>[l("span",Z,[o(v,{onClick:e[20]||(e[20]=s=>t.dialogVisible=!1)},{default:i(()=>e[31]||(e[31]=[T("取消")])),_:1}),o(v,{type:"primary",onClick:d.saveTemplate,loading:t.saving},{default:i(()=>e[32]||(e[32]=[T(" 保存 ")])),_:1},8,["onClick","loading"])])]),default:i(()=>[o(P,{model:t.currentTemplate,"label-position":"top",rules:t.formRules,ref:"templateForm"},{default:i(()=>[l("div",A,[o(n,{label:"模板ID",prop:"templateId"},{default:i(()=>[o(p,{modelValue:t.currentTemplate.templateId,"onUpdate:modelValue":e[4]||(e[4]=s=>t.currentTemplate.templateId=s),disabled:t.dialogType==="edit"},null,8,["modelValue","disabled"])]),_:1}),o(n,{label:"产品类型",prop:"productType"},{default:i(()=>[o(b,{modelValue:t.currentTemplate.productType,"onUpdate:modelValue":e[5]||(e[5]=s=>t.currentTemplate.productType=s),style:{width:"100%"}},{default:i(()=>[(u(!0),y(V,null,h(t.productTypes,s=>(u(),_(c,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"应用场景",prop:"applicationScene"},{default:i(()=>[o(b,{modelValue:t.currentTemplate.applicationScene,"onUpdate:modelValue":e[6]||(e[6]=s=>t.currentTemplate.applicationScene=s),style:{width:"100%"}},{default:i(()=>[(u(!0),y(V,null,h(t.applicationScenes,s=>(u(),_(c,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"风格类型",prop:"styleType"},{default:i(()=>[o(b,{modelValue:t.currentTemplate.styleType,"onUpdate:modelValue":e[7]||(e[7]=s=>t.currentTemplate.styleType=s),style:{width:"100%"}},{default:i(()=>[(u(!0),y(V,null,h(t.styleTypes,s=>(u(),_(c,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"位置",prop:"position"},{default:i(()=>[o(p,{modelValue:t.currentTemplate.position,"onUpdate:modelValue":e[8]||(e[8]=s=>t.currentTemplate.position=s)},null,8,["modelValue"])]),_:1}),o(n,{label:"特点文字位置",prop:"featurePosition"},{default:i(()=>[o(p,{modelValue:t.currentTemplate.featurePosition,"onUpdate:modelValue":e[9]||(e[9]=s=>t.currentTemplate.featurePosition=s)},null,8,["modelValue"])]),_:1}),o(n,{label:"海报尺寸",prop:"posterSize"},{default:i(()=>[o(b,{modelValue:t.currentTemplate.posterSize,"onUpdate:modelValue":e[10]||(e[10]=s=>t.currentTemplate.posterSize=s),style:{width:"100%"}},{default:i(()=>[o(c,{label:"1:1 (正方形)",value:"1:1"}),o(c,{label:"4:3 (标准)",value:"4:3"}),o(c,{label:"16:9 (宽屏)",value:"16:9"}),o(c,{label:"9:16 (垂直)",value:"9:16"}),o(c,{label:"3:4 (垂直)",value:"3:4"})]),_:1},8,["modelValue"])]),_:1})]),o(n,{label:"前景描述",prop:"foreground"},{default:i(()=>[o(p,{type:"textarea",modelValue:t.currentTemplate.foreground,"onUpdate:modelValue":e[11]||(e[11]=s=>t.currentTemplate.foreground=s),rows:"3"},null,8,["modelValue"])]),_:1}),o(n,{label:"背景",prop:"background"},{default:i(()=>[o(p,{type:"textarea",modelValue:t.currentTemplate.background,"onUpdate:modelValue":e[12]||(e[12]=s=>t.currentTemplate.background=s),rows:"3"},null,8,["modelValue"])]),_:1}),l("div",G,[o(n,{label:"整体布局",prop:"layout"},{default:i(()=>[o(p,{type:"textarea",modelValue:t.currentTemplate.layout,"onUpdate:modelValue":e[13]||(e[13]=s=>t.currentTemplate.layout=s),rows:"2"},null,8,["modelValue"])]),_:1}),o(n,{label:"背景描述",prop:"backgroundDesc"},{default:i(()=>[o(p,{type:"textarea",modelValue:t.currentTemplate.backgroundDesc,"onUpdate:modelValue":e[14]||(e[14]=s=>t.currentTemplate.backgroundDesc=s),rows:"2"},null,8,["modelValue"])]),_:1})]),l("div",H,[o(n,{label:"光影要求",prop:"lightingRequirements"},{default:i(()=>[o(p,{type:"textarea",modelValue:t.currentTemplate.lightingRequirements,"onUpdate:modelValue":e[15]||(e[15]=s=>t.currentTemplate.lightingRequirements=s),rows:"2"},null,8,["modelValue"])]),_:1}),o(n,{label:"文字要求",prop:"textRequirements"},{default:i(()=>[o(p,{type:"textarea",modelValue:t.currentTemplate.textRequirements,"onUpdate:modelValue":e[16]||(e[16]=s=>t.currentTemplate.textRequirements=s),rows:"2"},null,8,["modelValue"])]),_:1})]),l("div",Q,[o(n,{label:"色调要求",prop:"colorTone"},{default:i(()=>[o(p,{type:"textarea",modelValue:t.currentTemplate.colorTone,"onUpdate:modelValue":e[17]||(e[17]=s=>t.currentTemplate.colorTone=s),rows:"2"},null,8,["modelValue"])]),_:1}),o(n,{label:"整体风格",prop:"overallStyle"},{default:i(()=>[o(p,{type:"textarea",modelValue:t.currentTemplate.overallStyle,"onUpdate:modelValue":e[18]||(e[18]=s=>t.currentTemplate.overallStyle=s),rows:"2"},null,8,["modelValue"])]),_:1})]),o(n,{label:"描述",prop:"description"},{default:i(()=>[o(p,{type:"textarea",modelValue:t.currentTemplate.description,"onUpdate:modelValue":e[19]||(e[19]=s=>t.currentTemplate.description=s),rows:"2"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),l("div",W,[e[30]||(e[30]=l("h3",null,"最终提示词预览",-1)),l("div",X,[l("div",Y,a(d.generatedPrompt),1)])])]),_:1},8,["modelValue","title"]),o(k,{modelValue:t.viewDialogVisible,"onUpdate:modelValue":e[25]||(e[25]=s=>t.viewDialogVisible=s),title:"模板详情",width:"80%"},{footer:i(()=>[l("span",He,[o(v,{onClick:e[23]||(e[23]=s=>t.viewDialogVisible=!1)},{default:i(()=>e[56]||(e[56]=[T("关闭")])),_:1}),o(v,{type:"primary",onClick:e[24]||(e[24]=s=>d.editTemplate(t.currentTemplate))},{default:i(()=>e[57]||(e[57]=[T(" 编辑模板 ")])),_:1})])]),default:i(()=>[t.currentTemplate?(u(),y("div",$,[l("div",ee,[l("h2",null,a(t.currentTemplate.productType)+" - "+a(t.currentTemplate.styleType),1),l("div",le,[l("div",te,[e[33]||(e[33]=l("span",{class:"label"},"模板ID:",-1)),l("span",se,a(t.currentTemplate.templateId),1)]),l("div",oe,[e[34]||(e[34]=l("span",{class:"label"},"评分:",-1)),l("span",re,[o(S,{modelValue:t.currentTemplate.score,"onUpdate:modelValue":e[22]||(e[22]=s=>t.currentTemplate.score=s),disabled:"","text-color":"#ff9900"},null,8,["modelValue"]),T(" ("+a(t.currentTemplate.score.toFixed(1))+") ",1)])]),l("div",ie,[e[35]||(e[35]=l("span",{class:"label"},"使用次数:",-1)),l("span",ae,a(t.currentTemplate.usageCount),1)]),l("div",ne,[e[36]||(e[36]=l("span",{class:"label"},"创建时间:",-1)),l("span",de,a(d.formatDate(t.currentTemplate.createdAt)),1)]),l("div",ue,[e[37]||(e[37]=l("span",{class:"label"},"更新时间:",-1)),l("span",pe,a(d.formatDate(t.currentTemplate.updatedAt)),1)])])]),l("div",me,[l("div",ce,[e[44]||(e[44]=l("h3",null,"基本信息",-1)),l("div",fe,[e[38]||(e[38]=l("div",{class:"detail-label"},"产品类型",-1)),l("div",Te,a(t.currentTemplate.productType),1)]),l("div",ve,[e[39]||(e[39]=l("div",{class:"detail-label"},"应用场景",-1)),l("div",ge,a(t.currentTemplate.applicationScene),1)]),l("div",ye,[e[40]||(e[40]=l("div",{class:"detail-label"},"风格类型",-1)),l("div",be,a(t.currentTemplate.styleType),1)]),l("div",_e,[e[41]||(e[41]=l("div",{class:"detail-label"},"位置",-1)),l("div",Ve,a(t.currentTemplate.position),1)]),l("div",he,[e[42]||(e[42]=l("div",{class:"detail-label"},"特点文字位置",-1)),l("div",we,a(t.currentTemplate.featurePosition),1)]),l("div",Se,[e[43]||(e[43]=l("div",{class:"detail-label"},"海报尺寸",-1)),l("div",ke,a(t.currentTemplate.posterSize),1)]),e[45]||(e[45]=l("h3",null,"描述",-1)),l("div",Ce,a(t.currentTemplate.description),1)]),l("div",De,[e[54]||(e[54]=l("h3",null,"元素描述",-1)),l("div",xe,[e[46]||(e[46]=l("div",{class:"detail-label"},"前景描述",-1)),l("div",Ue,a(t.currentTemplate.foreground),1)]),l("div",Le,[e[47]||(e[47]=l("div",{class:"detail-label"},"背景",-1)),l("div",Pe,a(t.currentTemplate.background),1)]),l("div",Re,[e[48]||(e[48]=l("div",{class:"detail-label"},"整体布局",-1)),l("div",Ie,a(t.currentTemplate.layout),1)]),l("div",qe,[e[49]||(e[49]=l("div",{class:"detail-label"},"背景描述",-1)),l("div",Ee,a(t.currentTemplate.backgroundDesc),1)]),l("div",ze,[e[50]||(e[50]=l("div",{class:"detail-label"},"光影要求",-1)),l("div",Fe,a(t.currentTemplate.lightingRequirements),1)]),l("div",Ne,[e[51]||(e[51]=l("div",{class:"detail-label"},"文字要求",-1)),l("div",Oe,a(t.currentTemplate.textRequirements),1)]),l("div",Be,[e[52]||(e[52]=l("div",{class:"detail-label"},"色调要求",-1)),l("div",Me,a(t.currentTemplate.colorTone),1)]),l("div",je,[e[53]||(e[53]=l("div",{class:"detail-label"},"整体风格",-1)),l("div",Je,a(t.currentTemplate.overallStyle),1)])])]),l("div",Ke,[e[55]||(e[55]=l("h3",null,"最终提示词预览",-1)),l("div",Ae,[l("div",Ge,a(d.viewGeneratedPrompt),1)])])])):F("",!0)]),_:1},8,["modelValue"])])}const Xe=I(N,[["render",Qe],["__scopeId","data-v-02ff59c3"],["__file","F:/LocalSyn/Cursor/PosterMaker/src/client/views/TemplateManager.vue"]]);export{Xe as default};
